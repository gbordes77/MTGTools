"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7187],{8974:(e,t,n)=>{n.d(t,{Z:()=>s});class r{setVisibilityCheck(e){this.checkFn=e}clearVisibilityCheck(){this.checkFn=null}isVisible(){return!this.checkFn||this.checkFn()}constructor(){this.checkFn=null}}let s=new r},17936:(e,t,n)=>{n.d(t,{W:()=>c});var r=n(54568),s=n(10158),i=n(1761),a=n(27261),l=n.n(a),o=n(62971);let u=()=>{let e=(0,s.fZ)(),{websiteBaseUrl:t}=(0,s._r)();return e?(0,r.jsx)(o.A,{defaultMessage:"Or consider <link>upgrading to Claude Pro</link>.",id:"j0jOXOpUyS",values:{link:e=>(0,r.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,r.jsx)(o.A,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,r.jsx)(l(),{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})};function c(){let e=(0,i.UC)(),t=(0,i.r$)();return e&&!t?(0,r.jsx)(u,{}):null}},18483:(e,t,n)=>{n.d(t,{SC:()=>c,UW:()=>l,Xn:()=>a,ey:()=>o,lK:()=>u});var r=n(29098),s=n.n(r),i=n(40459);s().join(i.cwd(),"public/i18n"),s().join(i.cwd(),"public/i18n/secret");let a="en-US",l={"xx-LS":{name:"Long stringsSSSSSSSS"},"xx-AC":{name:"ALL CAPS"},"xx-HA":{name:"[javascript] prefixed strings"},"en-XA":{name:"Ȧȧƈƈḗḗƞŧḗḗḓ Ḗḗƞɠŀīīşħ"},"en-XB":{name:"ɥsıʅƃuƎ ıpıԐ"}};function o(e){return"".concat("secret",":").concat(e)}function u(e){return"".concat("statsig",":").concat(e)}Object.keys(l);let c=["en-US","de-DE","fr-FR","ko-KR","ja-JP","es-419","es-ES","it-IT","hi-IN","pt-BR","id-ID"]},19303:(e,t,n)=>{n.d(t,{G:()=>c});var r=n(7726),s=n(1761),i=n(71473),a=n(87606),l=n(7620),o=n(57067),u=n(80079);let c=e=>{let t=(0,a.useQueryClient)(),{activeOrganization:n}=(0,s.YL)(),c=null==n?void 0:n.uuid,d=(0,l.useRef)(void 0),h=(0,u.$)(),_=(0,l.useCallback)(async(e,n)=>{let r=[i.fC,{orgUUID:c},{uuid:e}],s=t.getQueryData(r);if(!s)throw Error("Conversation tree must be provided for append");d.current=n(s),await t.cancelQueries({queryKey:r}),t.setQueryData(r,d.current)},[t,c]),m=(0,l.useRef)(new Set),p=(0,l.useCallback)((n,r)=>{0!==r.length&&(e&&!m.current.has(n)&&r.some(e=>"text"===e.type&&e.text&&e.text.trim().length>0)&&(m.current.add(n),e()),t.setQueryData([i.fC,{orgUUID:c},{uuid:n}],()=>{let e=d.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=r,{...e,created_at:new Date().toISOString()}}))},[t,c,e]);return{onStartAppend:_,onStreamCompleted:(0,l.useCallback)((e,n)=>{t.invalidateQueries({queryKey:[i.fC,{orgUUID:c}]}),t.invalidateQueries({queryKey:["FEATURE_LIMITS",c]});let s=d.current,a=(null==s?void 0:s.chat_messages)&&s.chat_messages.length<=2;s&&a&&!s.is_temporary&&(t.setQueriesData({queryKey:[i.DC,{orgUUID:c}],predicate:e=>{let{queryKey:t}=e,n=t[2];return!(null==n?void 0:n.starred)}},t=>t?[{uuid:e,name:s.name,summary:s.summary,updated_at:s.updated_at,created_at:s.created_at,project_uuid:s.project_uuid,model:s.model,settings:s.settings,is_starred:!1},...t].slice(0,r.sk):t),t.setQueryData([i.Ad,{orgUUID:c}],e=>{var t;return{is_first_conversation:!1,count:(null!=(t=null==e?void 0:e.count)?t:0)+1}})),n&&c&&h(n,c,e)},[t,h,c]),onIncrementalCompletion:p,changeDisplayedConversationPath:(0,l.useCallback)((e,n,r,s)=>{t.setQueryData([i.fC,{orgUUID:c},{uuid:e}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,o.gX)(e,n,r);return t.current_leaf_message_uuid&&s&&s(t.current_leaf_message_uuid),t})},[t,c])}}},31198:(e,t,n)=>{n.d(t,{v:()=>i,x:()=>a});var r=n(7620);let s="customSystemPrompt",i=()=>{let[e,t]=(0,r.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(s)||"");return(0,r.useEffect)(()=>{localStorage.setItem(s,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},a=()=>"undefined"==typeof localStorage?"":localStorage.getItem(s)},55428:(e,t,n)=>{n.d(t,{O0:()=>s,yz:()=>r}),n(40459);let r=()=>!1,s=()=>r()},55554:(e,t,n)=>{n.d(t,{TierSelectorProvider:()=>d,t:()=>c});var r=n(54568),s=n(46612),i=n(27062),a=n(85544),l=n(7620),o=n(96712);let u=(0,l.createContext)(null),c=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},d=e=>{var t;let{children:n,initialEnabled:c=!1}=e,d=(0,o.l)(),[h,_]=(0,l.useState)(()=>d.get(s.eT.SELECTED_TIER)||null),[m,p]=(0,l.useState)(()=>"true"===d.get(s.eT.SHOULD_OVERRIDE_TOKEN_LIMITS)),[f,g]=(0,l.useState)(()=>"true"===d.get(s.eT.SHOULD_OVERRIDE_FEATURE_ACCESS)),k=null!=(t=(0,i.fS)("internal_tier_selector").value)?t:c,v=(0,l.useState)(k)[1],x=(0,l.useCallback)(()=>{let e=[a.d7.FREE,a.d7.PRO,a.d7.ENTERPRISE,a.d7.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),y=(0,l.useCallback)(e=>{if(!k)return void _(e);if(null===e){let e=h||x();d.set(s.eT.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else d.set(s.eT.SELECTED_TIER,e);_(e)},[h,_,d,x,k]);(0,l.useEffect)(()=>{k?h&&d.set(s.eT.SELECTED_TIER,h):d.delete(s.eT.SELECTED_TIER)},[k,h,d]);let b=(0,l.useCallback)(e=>{if(!k)return void p(e);e?d.set(s.eT.SHOULD_OVERRIDE_TOKEN_LIMITS,"true"):d.delete(s.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),p(e)},[k,d]),C=(0,l.useCallback)(e=>{if(!k)return void g(e);e?d.set(s.eT.SHOULD_OVERRIDE_FEATURE_ACCESS,"true"):d.delete(s.eT.SHOULD_OVERRIDE_FEATURE_ACCESS),g(e)},[k,d]);return(0,l.useEffect)(()=>{k||(d.delete(s.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),d.delete(s.eT.SHOULD_OVERRIDE_FEATURE_ACCESS))},[k,d]),(0,r.jsx)(u.Provider,{value:{selectedTier:h,isTierSelectorEnabled:k,setSelectedTier:y,setIsTierSelectorEnabled:v,shouldOverrideTokenLimits:m,setShouldOverrideTokenLimits:b,shouldOverrideFeatureAccess:f,setShouldOverrideFeatureAccess:C},children:n})}},66442:(e,t,n)=>{n.d(t,{ep:()=>_,OZ:()=>h,xD:()=>p});var r=n(29585),s=n(8035),i=n(72034),a=n(70825);let l=(e,t,n)=>{let{blockSize:r,sliceBlock:s}=e,i=[];if(n<=0)return[];let a=0;for(let e of t){if(a+r(e)>=n){i.push(s(e,n-a));break}i.push(e),a+=r(e)}return i},o=1e3/60;class u{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];if(this.x>=this.totalCompletionLength)return this.smoothed_completion_is_unchanged=!0,l(this.blockOperations,this.blocksList,this.totalCompletionLength);let r=(Date.now()-this.start)/1e3,s=this.arrivals[this.arrivals.length-1][1]+(this.model_done||this.force_smoother_done?100:0),i=.9*r-(null!=(n=null==(e=(t=this.blockOperations).getBlockDeadlineOffset)?void 0:e.call(t))?n:.3),a=this.arrivals.filter(e=>e[0]<i).map(e=>e[1]),o=a[a.length-1],u=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let s=e(t),i=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(s>r)throw Error("Lower f is greater than zero");if(i<-r)throw Error("Upper f is less than zero");for(;s<-r;){let r=(t+n)/2,a=e(r);a<=0?(t=r,s=a):(n=r,i=a)}return t}(e=>{let t=(e-this.x)/(r-this.t),n=1/(r-this.t);return 2*(this.force_smoother_done?.01*this.gamma:this.gamma)*n*(t-this.v)-1/(e-o)+1/(s-e)},o,s),c=(u-this.x)/(r-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*c,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(u,this.x),this.t=r,this.stats.push({t:r,x:u,v:c,min_chars:o,max_chars:s}),l(this.blockOperations,this.blocksList,this.x)}get smootherDone(){return this.force_smoother_done||this.model_done&&this.x>=this.totalCompletionLength}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){let t;switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let n=(t=this.blockOperations,this.blocksList.reduce((e,n)=>e+t.blockSize(n),0));if(this.totalCompletionLength=n,this.arrivals.push([(Date.now()-this.start)/1e3,n]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smootherDone&&!t.aborted;){if(document.hidden){await new Promise(e=>setTimeout(e,200));continue}if(this.x>=this.totalCompletionLength&&this.model_done)break;if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}let t=!0;if(this.checkVisibility){let e=Date.now();e-this.lastVisibilityCheck>1e3&&(this.cachedVisibility=this.checkVisibility(),this.lastVisibilityCheck=e),t=this.cachedVisibility}let n=t?o:100;await new Promise(e=>setTimeout(e,n))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.force_smoother_done=!1,this.stats=[],this.blocksList=[],this.lastVisibilityCheck=0,this.cachedVisibility=!0,this.blockOperations=e}}var c=n(8974);let d=null,h=()=>{d&&(d.force_smoother_done=!0)};var _=function(e){return e[e.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",e[e.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",e}({});let m=["close_file","create_file","delete_file","file_search","open_file","repl","str_replace","update_file"];async function p(e){let t,n,{applicationType:l,endpoint:o,orgUuid:h,conversationUuid:_,body:p,onCompletion:f,onInvokeTool:g,abortController:k,completion:v,getTools:x,smoothingEnabled:y=!0}=e,b=function(){let e=new Map,t=!1;return new u({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null==(t=e.partial_json)?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null==(n=e.partial_json)?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(n,r)=>{switch(r.type){case"text":switch(t=!1,n.delta.type){case"text_delta":return{...r,text:r.text+n.delta.text};case"citation_start_delta":{let t=n.delta.citation;return e.set(t.uuid,{...t,start_index:r.text.length}),r}case"citation_end_delta":{let t=n.delta.citation_uuid,s=e.get(t);if(!s)return r;let i=r.citations?[...r.citations]:[];return i.push({...s,end_index:r.text.length}),{...r,citations:i}}default:return r}case"thinking":switch(t=!0,n.delta.type){case"thinking_delta":return{...r,thinking:r.thinking+n.delta.thinking};case"thinking_summary_delta":return{...r,summaries:[...r.summaries||[],n.delta.summary]};case"thinking_cut_off_delta":return{...r,cut_off:n.delta.cut_off};default:return r}case"tool_result":if(t=!1,"input_json_delta"===n.delta.type)return{...r,content:[{type:"text",text:n.delta.partial_json}]};return r;case"tool_use":var s;if(t=!1,"input_json_delta"!==n.delta.type)return r;return{...r,partial_json:(null!=(s=r.partial_json)?s:"")+n.delta.partial_json}}},stopBlockEvent:(e,t)=>{if("thinking"===t.type)return{...t,stop_timestamp:e.stop_timestamp};if("tool_use"===t.type){var n;return{...t,buffered_input:null!=(n=e.buffered_input)?n:"{}"}}return t},getBlockDeadlineOffset(){if(t)return 3}})}();d=b,b.dont_smooth=!y,b.on_completion=f,b.checkVisibility=()=>c.Z.isVisible();let C=y?b.task(f,k.signal):Promise.resolve(),E={"Content-Type":"application/json",Accept:"text/event-stream",...(0,s._)(l)},S=null,w=null,L=JSON.stringify({...v,...p,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),T="",j="",O="",D=0,I=(0,i.y)(function(e,t,n){let r;if(void 0===t||void 0===n)throw Error("Missing org uuid or conversation uuid");switch(e){case 1:r="completion";break;case 2:r="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(r)}(o,h,_),{method:"POST",credentials:"include",headers:E,body:L,openWhenHidden:!0,signal:k.signal,async onopen(e){var t;if(!e.ok||!(null==(t=e.headers.get("content-type"))?void 0:t.includes(i.o))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,r.a5)(e.status,n,"Failed to fetch",e.headers)}},onmessage:e=>{var s,i;switch(e.event){case"ping":default:return;case"error":throw(0,r.a5)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let t=JSON.parse(e.data);if(void 0===t.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let n={type:"content_block_delta",index:0,delta:{type:"text_delta",text:t.completion}};S=t.stop_reason,w=null!=(s=t.messageLimit)?s:null,b.onMessage(n);break}case"content_block_start":{let r=JSON.parse(e.data);D=r.index,"tool_use"===r.content_block.type&&(j=r.content_block.name,O=r.content_block.id,t=r.content_block.approval_options,n=r.content_block.approval_key),b.onMessage(r);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==D&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null==(i=t.delta)?void 0:i.type)==="input_json_delta"&&(m.includes(j)||x().some(e=>e.name===j||j.endsWith(":".concat(e.name)))||n)&&(T+=t.delta.partial_json),b.onMessage(t);break}case"content_block_stop":{let r=JSON.parse(e.data);if(r.index!==D)throw Error("Content block index did not match the expected index");if(r.buffered_input=T,b.onMessage(r),!j)break;g(_,j,O,T,{},t,n),T="",j="",O="",t=void 0,n=void 0;break}case"message_limit":w=JSON.parse(e.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let t=JSON.parse(e.data);"message_stop"===t.type&&(S="message_stop"),b.onMessage(t)}}},onclose(){b.model_done=!0},onerror(e){throw e instanceof r.LG&&529===e.statusCode||(0,a.Cp)(e),b.model_done=!0,b.force_smoother_done=!0,e}});return await Promise.all([I,C]),d=null,{stopReason:S,messageLimitResult:w}}},77187:(e,t,n)=>{n.d(t,{Gw:()=>N,SL:()=>P,Z3:()=>z,c7:()=>A,x:()=>H});var r=n(54568),s=n(7726),i=n(17936),a=n(98518),l=n(10158),o=n(1761),u=n(51121),c=n(18483),d=n(29585),h=n(46612),_=n(55428),m=n(71473),p=n(27062),f=n(75632),g=n(70825),k=n(21036),v=n(87606),x=n(67933),y=n(68864),b=n(27261),C=n.n(b),E=n(62942),S=n(7620),w=n(62971),L=n(46760),T=n(75006),j=n(66442),O=n(57067),D=n(31198),I=n(80079),M=n(19303);let R=(0,S.createContext)([null,null]);function A(e){let{children:t}=e,n=(0,S.useState)({});return(0,r.jsx)(R.Provider,{value:n,children:t})}function N(e,t,n,r){let{onIncrementalCompletion:s,onStartAppend:i,onStreamCompleted:a}=(0,M.G)(r),l=Q({conversationUUID:e,endpoint:j.ep.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:s,onStreamCompleted:a,onInvokeTool:t,getTools:n}),{runStream:o}=l,u=(0,S.useCallback)(async t=>{let{prompt:n,attachments:r,files:s,syncSources:a,rethrowErrors:l=!1,modelOverride:u,parent_message_uuid:c,personalized_style:d,compass_mode:h,org_type_override:_}=t;await i(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,O.ZQ)(e),i=[{uuid:O.Rh,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:r,files:s,files_v2:s,sync_sources:a,index:t+1,parent_message_uuid:null!=c?c:O.gF},{uuid:O.gv,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:O.Rh,metadata:{compass_mode:h}}];return(0,O.xQ)(e,i)}),await o({prompt:n,attachments:r,files:s,syncSources:a,rethrowErrors:l,modelOverride:u,parent_message_uuid:c,personalized_style:d,org_type_override:_})},[o,i,e]);return{...l,runStream:u}}function P(e,t,n,r,s){let{onIncrementalCompletion:i,onStreamCompleted:a,onStartAppend:l}=(0,M.G)(s),o=Q({conversationUUID:e,endpoint:j.ep.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:i,onInvokeTool:t,onStreamCompleted:a,getTools:n}),{runStream:u}=o,c=(0,S.useCallback)(async(t,n,s)=>{await l(e,e=>{let n=[{uuid:O.gv,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,O.ZQ)(e)+1}];return(0,O.xQ)(e,n)}),await u({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:r,paprika_mode:n,compass_mode:s,isRetry:!0})},[e,u,l,r]);return{...o,runStream:c}}let U="incomplete_stream",V=Error(U),W=T.z.object({model:T.z.string().nullable()}).nullable(),z=e=>{let t=B(e),n=(0,p.P0)("tepui_default_on_claude_free","model",null,p.Lu),r=(0,p.GZ)("console_default_model_override","model",null,W),s=(0,p.T9)("console_default_model","model",null,p.Lu);return t||n||(null==r?void 0:r.model)||s||"claude-2.1"},B=e=>{let t=(0,s.mz)(e||""),n=(0,E.useSearchParams)(),r=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:r||void 0},F={value:null},H=()=>{let e=(0,v.useQueryClient)();return{failedStreamRetryData:(0,x.useQuery)({queryKey:[m.xT],queryFn:()=>F.value,initialData:null}).data||null,setFailedStreamRetryData:(0,S.useCallback)(t=>{F.value=t,e.setQueryData([m.xT],t)},[e])}};function Q(e){var t;let{conversationUUID:n,endpoint:m,getTools:v,onIncrementalCompletion:x,onInvokeTool:b,onStreamCompleted:T}=e,{applicationType:O}=(0,l._r)(),{activeOrganization:M}=(0,o.YL)(),{value:A}=(0,p.fS)("apps_no_smoothing"),N=null==M?void 0:M.uuid,{context:P,clearContext:W,setContext:z}=function(e){let[t,n]=(0,S.useContext)(R),[r,s]=(0,S.useState)(),i=(0,S.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):s(void 0)},[e,n]),a=(0,S.useCallback)(t=>{n?n(n=>({...n,[e]:t})):s(t)},[e,n]);return{context:t?t[e]:r,clearContext:i,setContext:a}}(n),F=(0,E.useSearchParams)(),Q=null==F?void 0:F.get("t"),G=null!=(t=B(n))?t:"",Y=null==F?void 0:F.get("max_tokens"),K=(0,I.$)(),{addError:J,clearToast:q}=(0,u.Y)(),X=(0,S.useMemo)(f.N,[]),Z=(0,s.bT)("push",X),{setFailedStreamRetryData:$}=H(),ee=(0,S.useCallback)(async e=>{await (null==T?void 0:T(n,e)),W()},[T,n,W]),et=(0,S.useCallback)((e,t,s)=>{if(e===U)return J((0,r.jsx)("p",{children:(0,r.jsx)(w.A,{defaultMessage:"Claude’s response was interrupted. This can be caused by network problems or exceeding the maximum conversation length. Please <link>contact support</link> if the issue persists.",id:"sHRMIfTKu4",values:{link:e=>(0,r.jsx)(C(),{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})}));if(!(e instanceof d.LG))return J((0,r.jsx)(w.A,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"}));if("rate_limit_error"===e.type){if(e.message.includes("{")&&N)try{let t=JSON.parse(e.message);K(t,N,n)}catch(e){}if("thinking_messages_rate_limit_exceeded"===e.errorCode)return J((0,r.jsxs)("p",{children:[(0,r.jsx)(w.A,{defaultMessage:"You’ve reached your weekly limit for thinking messages. Please try again next week.",id:"uu/l1k2f+L"}),"\xa0",(0,r.jsx)(i.W,{})]}));if("opus_messages_rate_limit_exceeded"===e.errorCode)throw e;return J((0,r.jsxs)("p",{children:[(0,r.jsx)(w.A,{defaultMessage:"You’ve reached the limit for Claude messages at this time. Please wait before trying again.",id:"CBMEJMlMzs"}),"\xa0",(0,r.jsx)(i.W,{})]}))}if("not_found_error"===e.type)return J((0,r.jsx)(w.A,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"}));if("billing_error"===e.type)return J((0,r.jsx)("p",{children:(0,r.jsx)(w.A,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,r.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})}));if("overloaded_error"===e.type)return J((0,r.jsxs)("p",{children:[(0,r.jsx)(w.A,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),"\xa0",(0,r.jsx)(i.W,{})]}));if("exceeded_max_uploads_per_message"===e.errorCode)return void J((0,r.jsx)(w.A,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"}));if("exceeded_max_image_limit_per_chat"===e.errorCode){let e=J((0,r.jsx)("p",{children:s>0?(0,r.jsx)(w.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(i.W,{}),count:s}}):(0,r.jsx)(w.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}})}));return}if("invalid_request_error"===e.type&&413===e.statusCode){let e=J((0,r.jsx)("p",{children:t>0?(0,r.jsx)(w.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}}):(0,r.jsx)(w.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,r.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:t=>(0,r.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,r.jsx)(i.W,{})}})}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?J((0,r.jsx)("p",{children:(0,r.jsx)(w.A,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})})):J(e)},[J,N,K,n,Z,q]),en=(0,a.st)(),er=(0,k.useExperiment)("no_more_smoother"),es=(0,L.A)(),ei=(0,S.useCallback)(async e=>{let{prompt:t,attachments:r,files:s,syncSources:i,rethrowErrors:a=!1,modelOverride:l,parent_message_uuid:o,personalized_style:u,paprika_mode:h,compass_mode:p,org_type_override:f}=e;if(P)return;if(!M)throw Error("Cannot stream without an organization");let k=new AbortController;z({controller:k}),$(null);let C={prompt:t,parent_message_uuid:o,timezone:y.c9.local().zoneName||void 0,personalized_styles:u?[u]:void 0,locale:c.SC.includes(es.locale)?es.locale:c.Xn},E=(0,D.x)();E&&(C.custom_system_prompt=E),G&&"string"==typeof G&&(C.model=G),l&&(C.model=l),"string"==typeof Q&&(C.temperature=parseInt(Q)),Y&&"string"==typeof Y&&(C.max_tokens_to_sample=parseInt(Y)),h&&(C.paprika_mode=h),p&&(C.compass_mode=p);let S=v();S.length&&(C.tools=S);let w=[],L=null,T=null,I=null;try{let e=er.get("no_smoothing",!1);if(L=(I=await (0,j.xD)({applicationType:O,endpoint:m,orgUuid:M.uuid,conversationUuid:n,body:{organization_uuid:M.uuid,conversation_uuid:n,text:t,attachments:r,files:s.map(e=>e.file_uuid),sync_sources:i.map(e=>e.uuid),..."string"==typeof f&&{org_type_override:f}},onCompletion:e=>{x(n,e),w=e},onInvokeTool:b,abortController:k,completion:C,getTools:v,smoothingEnabled:!A&&!e})).stopReason,T=I.messageLimitResult,I&&!L)throw V}catch(i){let e=i instanceof d.LG;if($({prompt:t,attachments:r,files:s}),i===V?(x(n,w),et(U,r.length+s.length,s.filter(e=>"document"===e.file_kind).length),en.track({event_key:"sse_interrupted"}),(0,g.wd)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))):(et(i,r.length+s.length,s.filter(e=>"document"===e.file_kind).length),e||console.error("Non-API stream error:",i)),(0,g.Cp)(i,{tags:{source:e?"stream-api":"stream-generic"}}),a||(0,_.yz)())throw i}finally{await ee(T)}return w},[P,M,z,$,G,Q,Y,v,er,O,m,n,b,A,x,et,ee,en,es]),ea=(0,S.useCallback)(()=>{P&&(P.controller.abort(),W())},[P,W]);return{runStream:ei,isStreaming:!!P,abortStream:ea}}},80079:(e,t,n)=>{n.d(t,{$:()=>c,T:()=>d});var r=n(77186),s=n(1761),i=n(55554),a=n(71473),l=n(27062),o=n(87606),u=n(7620);let c=()=>{let e=(0,o.useQueryClient)();return(0,u.useCallback)((t,n,r)=>{"within_limit"!==t.type&&(t.conversationUUID=r),e.setQueryData([a.Rw],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},d=e=>{let{activeOrganization:t}=(0,s.YL)(),{selectedTier:n}=(0,i.t)(),{value:a}=(0,l.fS)("internal_tier_selector"),o=null==t?void 0:t.uuid,u=c(),d={type:"within_limit"};return(0,r.L2)(()=>"/api/organizations/".concat(o,"/reset_rate_limits"),"POST",{onSuccess:()=>{u(d,o,e||"")},meta:{noToast:!0},transformVariables:()=>a&&n?{org_type:n}:{}})}}}]);