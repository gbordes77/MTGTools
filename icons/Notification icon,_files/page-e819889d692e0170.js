(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{4530:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(54568),s=n(7620),a=n(31670);let o={darkMode:!0,primaryColor:"#333842",secondaryColor:"#21252B",tertiaryColor:"#abb2bf",primaryTextColor:"#ABB2BF",secondaryTextColor:"#5c6370",tertiaryTextColor:"#4b5263",primaryBorderColor:"#636D83",secondaryBorderColor:"#5c6370",tertiaryBorderColor:"#4b5263",edgeLabelBackground:"#282C34",lineColor:"#636D83",textColor:"#abb2bf",pie1:"#56b6c2",pie2:"#61afef",pie3:"#c678dd",pie4:"#98c379",pie5:"#e06c75",pie6:"#d19a66",pieStrokeColor:"#2C313A",pieOuterStrokeColor:"#2C313A",fillType0:"#0d7377",fillType1:"#1f4e79",fillType2:"#8e44ad",fillType3:"#317732",fillType4:"#a31d48",fillType5:"#8f5c38",fillType6:"#a37d18",fillType7:"#4c5056"},i=()=>{let[e,t]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{try{let e=await Promise.all([n.e(3220),n.e(2421),n.e(562)]).then(n.bind(n,60562));t(e.default)}catch(e){console.error("Failed to load Mermaid: ".concat(e))}})()},[]),e},l=e=>{let{content:t}=e,n=i();(0,s.useEffect)(()=>{null==n||n.initialize({securityLevel:"strict",theme:"base",themeCSS:".label foreignObject { overflow: visible; }",themeVariables:{fontFamily:"monospace",fontSize:"14px",...o}})},[n]),(0,s.useEffect)(()=>{n&&setTimeout(()=>{let e=document.getElementById("mermaid");null==e||e.removeAttribute("data-processed"),null==n||n.contentLoaded()},1)},[t,n]);let l=async()=>{if(document.fullscreenElement){var e,t;await (null==(e=(t=document).exitFullscreen)?void 0:e.call(t))}else await document.documentElement.requestFullscreen()};return n?(0,r.jsxs)(a.g,{style:{backgroundColor:"rgb(40, 44, 52)"},children:[(0,r.jsx)("div",{id:"mermaid",className:"mermaid flex max-h-full max-w-full grow items-center justify-center self-stretch bg-[#282C34] [&>svg]:max-h-full [&>svg]:max-w-full",children:t}),(0,r.jsx)("button",{onClick:l,className:"absolute bottom-2 right-2 z-10 rounded-md bg-[#3338421f] px-2 py-1 text-[#636D83] hover:bg-[#3338423f]"})]}):(0,r.jsx)(r.Fragment,{children:"Loading..."})}},5731:(e,t,n)=>{"use strict";n.d(t,{c:()=>f});var r=n(54568),s=n(7620),a=n(31670),o=n(7820),i=n.n(o),l=n(30019);let c=e=>{let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([0-9.]+))?\)/);if(!t)return console.error("Invalid color format:",e),e;let[,n,r,s,a="1"]=t,o=parseInt(n,10),l=parseInt(r,10),c=parseInt(s,10),d=parseFloat(a),[u,p,m]=i().rgb.hsl(o,l,c),f=Math.max(0,p-5),h=Math.max(0,m-25),[g,y,w]=i().hsl.rgb([u,f,h]);return"rgba(".concat(g,", ").concat(y,", ").concat(w,", ").concat(.8*d,")")},d=e=>{let t=new XMLSerializer().serializeToString(e),n=window.btoa(t);return"data:image/svg+xml;base64,".concat(n)},u=e=>{let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},p=async(e,t)=>{let n=d(e);return new Promise((e,r)=>{let s=new Image;s.onload=async()=>{let n=u(s);try{let r=await t.getColorAsync(n),s=c(r.rgba),a=r.isDark?"#fff":"#000";e({backgroundColor:s,textColor:a})}catch(e){r(e)}},s.onerror=r,s.src=n})},m=e=>{let[t,n]=(0,s.useState)(""),[r,a]=(0,s.useState)("");return(0,s.useEffect)(()=>{let t=new l.D,r=e.current;if(!r)return;let s=r.querySelector("svg");s&&p(s,t).then(e=>{let{backgroundColor:t,textColor:r}=e;n(t),a(r)}).catch(e=>{console.error("Error getting average color:",e)})},[e]),{backgroundColor:t,textColor:r}},f=e=>{let{content:t}=e,n=(0,s.useRef)(null),{backgroundColor:o,textColor:i}=m(n);return(0,r.jsx)(a.g,{style:{backgroundColor:o,color:i},children:(0,r.jsx)("div",{id:"artifacts-component-root-svg",ref:n,className:"h-full w-full",dangerouslySetInnerHTML:{__html:t}})})}},8008:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>ReplRenderer});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(54568),_ant_chat_components_Artifacts_api_actions__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21155),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7620);function ReplRenderer(param){let{initialCode="",sendRequest}=param,fetchData=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(async e=>{if(sendRequest)return(await sendRequest(_ant_chat_components_Artifacts_api_actions__WEBPACK_IMPORTED_MODULE_1__.uZ.GetFile,{key:e,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest"})).value},[sendRequest]),onFinish=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(e=>{null==sendRequest||sendRequest(_ant_chat_components_Artifacts_api_actions__WEBPACK_IMPORTED_MODULE_1__.uZ.SendConversationMessage,{messageType:"text",message:e,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest"})},[sendRequest]),onError=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(e=>{null==sendRequest||sendRequest(_ant_chat_components_Artifacts_api_actions__WEBPACK_IMPORTED_MODULE_1__.uZ.SendConversationMessage,{messageType:"error",message:e,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest"})},[sendRequest]);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{try{var _JSON_stringify;let res=eval(initialCode);onFinish(null!=(_JSON_stringify=JSON.stringify(res))?_JSON_stringify:"")}catch(err){onError(err instanceof Error?err.message:String(err))}},[initialCode,onError,onFinish]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{})}},25249:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ee});var r=n(54568),s=n(21155),a=n(75006);a.z.object({name:a.z.string().optional(),url:a.z.string().optional(),type:a.z.string().optional()});let o=["api.anthropic.com"],i=new Map;function l(e){let t=window.fetch;return window.fetch=async function(n,r){let a=new Request(n,r),l=new URL(a.url);if(!o.some(e=>l.hostname===e))return t(a);let c="fetch-".concat(Date.now(),"-").concat(Math.random()),d=null;try{d=await a.arrayBuffer()}catch(e){d=null}try{let t=await e.sendRequest(s.uZ.ProxyFetch,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchRequest",url:a.url,method:a.method,headers:Object.fromEntries(a.headers.entries()),body:d,channelId:c});if(!t||"object"!=typeof t)throw Error("Invalid response from proxy");let n=new ReadableStream({start(e){i.set(c,e)},cancel(){i.delete(c)}}),{status:r,statusText:o,headers:l}=t;return new Response(n,{status:r,statusText:o,headers:new Headers(l)})}catch(e){throw i.delete(c),e}},()=>{window.fetch=t,i.clear()}}function c(e,t,n,r){let s=i.get(e);s&&(r?(s.error(Error(r)),i.delete(e)):n?(s.close(),i.delete(e)):t&&s.enqueue(new Uint8Array(t)))}let d=new Map,u=()=>{let e=URL.createObjectURL.bind(URL),t=URL.revokeObjectURL.bind(URL);return window.originalCreateObjectUrl=e,URL.createObjectURL=e=>{let t="blob-".concat(Date.now(),"-").concat(Math.random());return d.set(t,e),"blob-request://".concat(t)},URL.revokeObjectURL=e=>{let t=e.replace("blob-request://","");d.delete(t)},()=>{URL.createObjectURL=e,URL.revokeObjectURL=t,window.originalCreateObjectUrl=void 0,d.clear()}},p=e=>{let t=e.replace("blob-request://","");return d.get(t)};var m=n(7620),f=n(53120);function h(e){let{parentWindow:t,allowedOrigins:n,onOutsideRequest:r}=e,[s,a]=(0,m.useState)(null);(0,m.useEffect)(()=>{if(t){let e=new f.m({parentWindow:t,allowedOrigins:n,onOutsideRequest:r});a(e);let s=l(e),o=u();return()=>{e.cleanup(),s(),o()}}},[t,n,r]);let o=(0,m.useCallback)(async(e,t)=>{if(s)return s.sendRequest(e,t);throw Error("Communicator not initialized")},[s]);return{sendRequest:null===s?void 0:o}}function g(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message}}}var y=n(54890),w=n(94515),b=n(69699),x=n(62942),v=n(79285);function E(e){let{enabled:t,children:n,sendRequest:a}=e,o=(0,m.useRef)(null);return((0,m.useLayoutEffect)(()=>{if(!o.current||!a||!t)return;let e=new ResizeObserver(e=>{let t=e[0].contentRect.height,n=e[0].contentRect.width;n&&t&&a(s.uZ.BroadcastContentSize,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload",height:t,width:n})});return e.observe(o.current),()=>{e.disconnect()}},[a,t]),t)?(0,r.jsx)("div",{ref:o,children:n}):n}var R=n(32218),C=n(7991),S=n(22710),M=n(49404);let j=e=>{let{title:t,description:n,subtext:s,inset:a,cta:o,onClick:i,ctaDisabled:l,insetStyle:c="default"}=e,d=()=>a?Array.isArray(a)?(0,r.jsx)("ul",{children:a.map((e,t)=>(0,r.jsx)("li",{children:e},t))}):a:null;return(0,r.jsxs)(M.Card,{className:"border-gray-200 w-[460px] max-w-full shadow-lg bg-bg-000",children:[(0,r.jsxs)(M.CardHeader,{className:"flex-row items-center space-y-0",children:[(0,r.jsx)(C.A,{className:"mr-2 h-5 w-5"}),(0,r.jsx)(M.CardTitle,{children:t})]}),(0,r.jsxs)(M.CardContent,{children:[(0,r.jsx)("p",{className:"mb-2 text-sm",children:n}),!!a&&(0,r.jsx)("div",{className:(0,R.A)("flex flex-col rounded-md bg-gray-100 p-2 font-mono text-xs","danger"===c&&"text-destructive"),children:d()}),!!s&&(0,r.jsx)("p",{className:"text-text-500 mt-2 text-sm",children:s}),!!o&&(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(S.Button,{className:"mt-4",onClick:i,disabled:l,children:o})})]})]})};var T=n(4530);let A=e=>{let{content:t}=e,n=(0,m.useRef)(null),[s,a]=(0,m.useState)(null),[o,i]=(0,m.useState)(!0),[l,c]=(0,m.useState)(0),d=(0,m.useRef)(null),u=(0,m.useRef)(new Map);return((0,m.useEffect)(()=>{if(!t||!n.current)return;let e=async()=>{try{let e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);let s=window.pdfjsLib.getDocument({data:r}),o=await s.promise;d.current=o,c(o.numPages),n.current.innerHTML="",u.current.clear();let l=document.createElement("div");l.className="space-y-4",n.current.appendChild(l);for(let e=1;e<=o.numPages;e++){let t=await o.getPage(e),n=t.getViewport({scale:1}),r=document.createElement("div");r.className="relative bg-white shadow-lg",r.id="page-".concat(e);let s=document.createElement("canvas"),a=s.getContext("2d");s.height=n.height,s.width=n.width,s.className="w-full",u.current.set(e,s);let i=document.createElement("div");i.className="absolute bottom-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 text-sm rounded",i.textContent="Page ".concat(e," / ").concat(o.numPages),r.appendChild(s),r.appendChild(i),l.appendChild(r);let c={canvasContext:a,viewport:n};await t.render(c).promise}i(!1),a(null)}catch(e){a("Failed to render PDF: ".concat(e instanceof Error?e.message:"Unknown error")),i(!1)}};return(async()=>{try{if(!window.pdfjsLib){let e=document.createElement("script");e.src="/libs/pdf.min.js",e.async=!0;let t=new Promise((t,n)=>{e.onload=t,e.onerror=()=>n(Error("Failed to load PDF.js library"))});document.head.appendChild(e),await t;let n=window.pdfjsLib;n.GlobalWorkerOptions&&(n.GlobalWorkerOptions.workerSrc="/libs/pdf.worker.min.js")}await e()}catch(e){a("Failed to load PDF: ".concat(e instanceof Error?e.message:"Unknown error")),i(!1)}})(),()=>{d.current&&(d.current.destroy(),d.current=null)}},[t]),s)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-red-500 mb-2 font-medium",children:s}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"The PDF file may be corrupted or invalid."})]})}):(0,r.jsxs)("div",{className:"h-full w-full bg-gray-100",children:[o&&(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,r.jsx)("div",{className:"text-gray-600",children:"Loading PDF..."}),(0,r.jsx)("div",{className:"mt-2 h-1 w-24 bg-blue-600 rounded-full animate-pulse mx-auto"})]})}),(0,r.jsx)("div",{ref:n,className:"h-full w-full overflow-auto p-4 ".concat(o?"hidden":""),id:"artifacts-component-root-pdf"})]})};var q=n(22198),k=n(8008),N=n(17674),P=n(5731),L=n(47901),F=n(53089),I=n(29080);let D=e=>(0,L.pd)(e,{transforms:["jsx","typescript","imports"],production:!0}).code.substring(13);function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=(0,I.r1)(e),r=window.location.origin,a=n.map(e=>{var t;let n=new URL(null==(t=F.A[e])?void 0:t.path,r).href;return"importScripts('".concat(n,"');")}).join("\n");return new Promise(r=>{var o,i;let l="\n      // For each library, import it.\n      ".concat(a,"\n\n      const dependencies = {\n        ").concat(n.map(e=>{var t;return"".concat(e,": ").concat(null==(t=F.A[e])?void 0:t.global)}).join(",\n  "),"\n      };\n\n      const mockRequire = (moduleName) => {\n        if (dependencies[moduleName]) {\n          return dependencies[moduleName];\n        }\n        throw new Error(`Module not found: '${moduleName}'`);\n      };\n\n      let pendingPromises = new Set();\n      let pendingTimers = new Set();\n\n      const originalPromise = Promise;\n      self.Promise = function (...args) {\n        const promise = new originalPromise(...args);\n        pendingPromises.add(promise);\n        promise.then(() => pendingPromises.delete(promise), () => pendingPromises.delete(promise));\n        return promise;\n      };\n\n      // Maintain static methods of Promise\n      Object.getOwnPropertyNames(originalPromise).forEach(prop => {\n        if (prop !== 'prototype' && typeof originalPromise[prop] === 'function') {\n          self.Promise[prop] = function(...args) {\n            const result = originalPromise[prop].apply(originalPromise, args);\n            if (result instanceof originalPromise) {\n              pendingPromises.add(result);\n              result.then(() => pendingPromises.delete(result), () => pendingPromises.delete(result));\n            }\n            return result;\n          };\n        }\n      });\n\n      const originalSetTimeout = self.setTimeout;\n      self.setTimeout = function (callback, delay, ...args) {\n        const timer = originalSetTimeout(() => {\n          pendingTimers.delete(timer);\n          callback(...args);\n        }, delay);\n        pendingTimers.add(timer);\n        return timer;\n      };\n\n      function waitForAsync() {\n        return new originalPromise(resolve => {\n          function check() {\n            if (pendingPromises.size === 0 && pendingTimers.size === 0) {\n              resolve();\n            } else {\n              originalSetTimeout(check, 0);\n            }\n          }\n          check();\n        });\n      }\n\n      const stringifyArg = (arg) => {\n        if (typeof arg === 'object' && arg !== null) {\n          try {\n            return JSON.stringify(arg);\n          } catch (error) {\n            return '[Unstringifiable Value]';\n          }\n        }\n        return String(arg);\n      };\n\n      const logs = [];\n      const originalConsole = console;\n      console = {\n        log: (...args) => {\n          const stringifiedArgs = args.map(stringifyArg);\n          logs.push(stringifiedArgs.join(' '));\n        },\n        warn: (...args) => {\n          const stringifiedArgs = args.map(stringifyArg);\n          logs.push('WARN: ' + stringifiedArgs.join(' '));\n        },\n        error: (...args) => {\n          const stringifiedArgs = args.map(stringifyArg);\n          logs.push('ERROR: ' + stringifiedArgs.join(' '));\n        }\n      };\n\n\n      // In case of multiple files, use a map\n      let requestId = 0;\n      const callbacksMap = new Map();\n      \n      // Override global fetch\n      self.fetch = (url, init = {}) => {\n        return new Promise((resolve, reject) => {\n          const id = requestId++;\n          callbacksMap.set(id, { resolve, reject });\n          self.postMessage({\n            type: 'proxyFetch',\n            id,\n            url,\n            init,\n          });\n        });\n      };\n      \n      self.window = {\n        fs: {\n          readFile: async (filename, encoding) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              self.postMessage({ type: 'readFile', id, filename, encoding});\n            });\n          }\n        },\n        claude: {\n          complete: async (prompt) => {\n            return new Promise((resolve, reject) => {\n              const id = requestId++;\n              callbacksMap.set(id, { resolve, reject });\n              self.postMessage({ type: 'claudeComplete', id, prompt });\n            });\n          }\n        }\n      }\n\n      self.onmessage = async function(e) {\n        // Handle capability responses\n        if (e.data.type === 'fileContent') {\n          const callback = callbacksMap.get(e.data.id);\n          callback.resolve(e.data.content);\n          await waitForAsync();\n          callbacksMap.delete(e.data.id);\n          return;\n        } else if (e.data.type === 'fileError') {\n          const callback = callbacksMap.get(e.data.id);\n          callback.reject(new Error(e.data.error));\n          callbacksMap.delete(e.data.id);\n          return;\n        } else if (e.data.type === 'claudeComplete') {\n          const callback = callbacksMap.get(e.data.id);\n          if (e.data.error) {\n            callback.reject(new Error(e.data.error));\n          } else {\n            callback.resolve(e.data.completion);\n          }\n          callbacksMap.delete(e.data.id);\n          return;\n        } else if (e.data.type === 'proxyFetchResponse') {\n          const callback = callbacksMap.get(e.data.id);\n          if (e.data.error) {\n            callback.reject(new Error(e.data.error));\n          } else {\n            callback.resolve(new Response(e.data.body, {\n              status: e.data.status,\n              statusText: e.data.statusText,\n              headers: e.data.headers\n            }));\n          }\n          callbacksMap.delete(e.data.id);\n          return;\n        } \n\n        // Handle code execution\n        const code = e.data;\n        const wrappedCode = `\n          return (async ({ require }) => {\n            ${code}\n          });\n        `;\n\n        try {\n          const fn = new Function(wrappedCode);\n          const result = await fn()({ require: mockRequire });\n          await waitForAsync();\n          self.postMessage({ status: 'success', result: JSON.stringify(result), logs });\n        } catch (error) {\n          self.postMessage({\n            status: 'error',\n            error: error instanceof Error ? error.message : String(error),\n            logs\n          });\n        }\n      };\n    "),c=new Worker((null==(o=(i=window).originalCreateObjectUrl)?void 0:o.call(i,new Blob([l],{type:"application/javascript"})))||""),d=setTimeout(()=>{c.terminate(),r({status:"error",logs:[],error:"Execution timed out"})},t);c.onmessage=async e=>{var t,n,a,o,i,l;if((null==(t=e.data)?void 0:t.type)==="readFile")try{let t=await window.fs.readFile(null==(o=e.data)?void 0:o.filename,null==(i=e.data)?void 0:i.encoding);c.postMessage({type:"fileContent",content:t,id:null==(l=e.data)?void 0:l.id})}catch(e){r({status:"error",logs:[],error:e instanceof Error?e.message:String(e)}),c.terminate()}else if((null==(n=e.data)?void 0:n.type)==="claudeComplete")try{let t=await window.claude.complete(e.data.prompt);c.postMessage({type:"claudeComplete",completion:t,id:e.data.id})}catch(t){c.postMessage({type:"claudeComplete",error:t instanceof Error?t.message:String(t),id:e.data.id})}else if((null==(a=e.data)?void 0:a.type)==="proxyFetch")try{let t=await fetch(e.data.url,e.data.init);t.body?c.postMessage({type:"proxyFetchResponse",id:e.data.id,headers:Object.fromEntries(t.headers.entries()),status:t.status,statusText:t.statusText,body:t.body},[t.body]):c.postMessage({type:"proxyFetchResponse",id:e.data.id,headers:Object.fromEntries(t.headers.entries()),status:t.status,statusText:t.statusText})}catch(t){c.postMessage({type:"proxyFetchResponse",id:e.data.id,error:t instanceof Error?t.message:String(t)})}else{clearTimeout(d),c.terminate();let t=s.Ub.safeParse(e.data);t.success?r(t.data):r({status:"error",logs:[],error:"Invalid execution result: "+t.error.message})}},c.postMessage(D(e))})}let U=e=>{let{sendRequest:t,handleError:n}=e;(0,m.useEffect)(()=>{let e=void 0===t?async(e,t)=>Promise.resolve(null):async(e,r)=>{try{let n=await t(s.uZ.GetFile,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest",key:e});if("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse"!==n["@type"])throw Error("Unexpected response type");let a=n.value;if(null===a)throw Error('File not found: No file named "'.concat(e,'"'));let o=(null==r?void 0:r.encoding)||null;if("utf8"===o||"utf-8"===o||"utf_8"===o)return new TextDecoder("utf-8").decode(a);if("binary"===o||null===o)return a;throw Error("Unsupported encoding: ".concat(o))}catch(t){throw t instanceof Error?t.message.startsWith("File not found:")?n({type:"FileNotFound",fileName:e}):n({type:"RuntimeError",message:t.message}):n({type:"RuntimeError",message:String(t)}),t}},r=(e,t)=>{throw Error("Synchronous file operations are not supported in this environment. Please use readFile instead.")},a=void 0===t?async e=>Promise.resolve(""):async e=>{try{var r;let n=await t(s.uZ.ClaudeCompletion,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest",prompt:e});if("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse"!==n["@type"])throw Error("Unexpected response type");return null!=(r=n.completion)?r:""}catch(e){return n({type:"ClaudeCompletionError",message:e instanceof Error?e.message:String(e)}),""}},o=e=>{null==t||t(s.uZ.SendConversationMessage,{messageType:"text",message:e,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest"})},i=e=>{null==t||t(s.uZ.OpenExternal,{href:e,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"})},l=e=>{null==t||t(s.uZ.DownloadFile,{filename:e.filename,data:e.data,mimeType:e.mimeType,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile"})};window.fs={readFile:e,readFileSync:r},window.claude={complete:a,sendConversationMessage:o,openExternal:i,downloadFile:l},window.open=e=>(e&&i(e.toString()),null)},[t,n])},_={rootSelectors:["#artifacts-component-root-svg","#artifacts-component-root-react","#mermaid",".research-report-content"]},B=["hover","focus","active","visited","focus-within","focus-visible","disabled","checked","indeterminate","required","optional","valid","invalid","in-range","out-of-range","read-only","read-write","placeholder-shown","default","empty","enabled","first-child","last-child","only-child","first-of-type","last-of-type","only-of-type","nth-child\\([^)]+\\)","nth-last-child\\([^)]+\\)","nth-of-type\\([^)]+\\)","nth-last-of-type\\([^)]+\\)","target","root","before","after","first-letter","first-line","selection","backdrop"],H=RegExp(":(?:".concat(B.join("|"),")"),"g");function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=[],r=new Set,s=[e,...Array.from(e.querySelectorAll("*"))],a=new Set,o=new Set,i=new Set,l=e=>{try{let t=e.replace(H,"");return s.some(n=>{try{return n.matches(t)||n.matches(e)}catch(e){return!1}})}catch(e){return!1}};for(let e of(s.forEach(e=>{var n;let r=null==(n=t.defaultView)?void 0:n.getComputedStyle(e);if(r){for(let e=0;e<r.length;e++)for(let t of r.getPropertyValue(r[e]).matchAll(/var\(([^)]+)\)/g)){let e=t[1].split(",")[0].trim();a.add(e)}let e=r.fontFamily;e&&(e.match(/("([^"]+)"|'([^']+)'|([^,]+))/g)||[]).forEach(e=>{let t=e.trim().replace(/^["']|["']$/g,"");o.add(t)});let t=r.animationName;t&&"none"!==t&&t.split(",").forEach(e=>{let t=e.trim();t&&"none"!==t&&i.add(t)})}}),t.styleSheets))try{if(r.has(e)||(r.add(e),e.href&&!e.href.includes(window.location.origin)))continue;if(e.href)for(let t of Array.from(e.cssRules||[]))z(t,l,a,o,i)&&n.push(K(t));else for(let t of Array.from(e.cssRules||[]))n.push(K(t))}catch(e){}return n.join("\n")}function z(e,t,n,r,s){let a=e.constructor.name;if("CSSStyleRule"===a){let r=e;if(t(r.selectorText)||":root"===r.selectorText&&r.cssText.includes("--")||Array.from(r.style).some(e=>e.startsWith("--")&&n.has(e)))return!0}else if("CSSMediaRule"===a||"CSSSupportsRule"===a)return!0;else if("CSSKeyframesRule"===a)return s.has(e.name);else if("CSSFontFaceRule"===a){var o,i,l,c;let t=e,n=(null==(i=t.style)||null==(o=i.fontFamily)?void 0:o.replace(/["']/g,"").trim())||(null==(c=t.cssText.match(/font-family:\s*["']?([^"';}\n]+)["']?/i))||null==(l=c[1])?void 0:l.trim());if(n&&Array.from(r).some(e=>e.toLowerCase()===n.toLowerCase()))return!0}return!1}let G={[Node.TEXT_NODE]:(e,t)=>t.createTextNode(e.textContent||""),[Node.ELEMENT_NODE]:(e,t)=>{let n=e,r=t.createElement(n.tagName.toLowerCase());for(let e of n.attributes)r.setAttribute(e.name,e.value);if("canvas"===n.tagName.toLowerCase())try{let e=n,r=e.toDataURL("image/png");if(r&&"data:,"!==r){let n=t.createElement("img");return n.src=r,n.width=e.width,n.height=e.height,n.className=e.className,e.style.cssText&&(n.style.cssText=e.style.cssText),n}}catch(e){}for(let e of n.childNodes){let n=G[e.nodeType];if(n){let s=n(e,t);s&&r.appendChild(s)}}return r}},W=(e,t)=>(0,G[Node.ELEMENT_NODE])(e,t);function V(e){let t=e.selectorText.split(",").map(e=>"body"===(e=e.trim())?".snapshot-body":"html"===e?".snapshot-frame":e.startsWith("@")||e.includes(".snapshot-")?e:".snapshot-body ".concat(e)).join(", "),n=e.style.cssText.replace(/100vh/g,"100%").replace(/100vw/g,"100%");return"".concat(t," { ").concat(n," }")}function K(e){let t=e.constructor.name;if("CSSStyleRule"===t)return V(e);if("CSSMediaRule"!==t&&"CSSSupportsRule"!==t)return e.cssText;{let n=Array.from(e.cssRules).map(K),r="CSSMediaRule"===t?"@media ".concat(e.conditionText):"@supports ".concat(e.conditionText);return"".concat(r," {\n").concat(n.join("\n"),"\n}")}}function J(e){let t=null,n=document;if("text/html"===e){let e=document.querySelector("iframe");if(!(null==e?void 0:e.contentDocument))return null;t=e.contentDocument.body,n=e.contentDocument}else{let e=null;for(let t of _.rootSelectors)if(e=document.querySelector(t))break;if(!e)return null;t=e}let r=Z(t,n),s=".snapshot-body { position: absolute; inset: 0; }",a="<style>\n".concat(s,"\n").concat(r||"","\n</style>"),o=W(t,document.implementation.createHTMLDocument());return a+'<div class="snapshot-body">'.concat(o.outerHTML,"</div>")}async function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;return Promise.race([new Promise(e=>setTimeout(()=>{e(null)},t)),new Promise(t=>{setTimeout(()=>{try{let n=J(e);t(n)}catch(e){t(null)}},0)})])}function X(){try{return window.self!==window.top}catch(e){return!0}}function Y(){let{defaultParentOrigin:e}=(0,v.t)();return(0,m.useCallback)(()=>{if(window.top)try{window.top.location.href="//".concat(e);return}catch(e){}window.location.href="//".concat(e)},[e])}function $(e){let{error:t}=e,n=g(t);return(0,r.jsx)("div",{className:"flex min-h-full w-full items-center justify-center bg-gray-100 p-4",children:(0,r.jsx)(j,{title:n.title,description:n.description,inset:n.inset,subtext:n.subtext,insetStyle:n.insetStyle})})}function ee(){let{allowedParents:e}=(0,v.t)(),t=Y(),[n,a]=(0,m.useState)(""),[o,i]=(0,m.useState)(),[l,d]=(0,m.useState)(!1),[u,f]=(0,m.useState)(!1),[g,R]=(0,m.useState)(null),[C,S]=(0,m.useState)(!1),M=(0,m.useRef)(null),L=(0,m.useRef)(null),F=(0,m.useRef)(null),I=(0,m.useMemo)(()=>e.map(e=>"".concat(e.scheme,"://").concat(e.origin)),[e]),D=(0,m.useCallback)(()=>{M.current&&(clearTimeout(M.current),M.current=null),S(!1)},[]),_=(0,m.useCallback)(e=>{F.current&&(F.current(e),F.current=null)},[]),B=()=>Array.from(document.querySelectorAll(".research-report-content")).map(e=>e.outerHTML).join(""),H=(0,m.useCallback)(async e=>{var t,n,r,l;let{method:u,payload:p}=e;if(D(),u===s.uZ.SetContent){R(null),a(p.content),i(p.type),f(null!=(t=p.tailwindStylesEnabled)&&t),d(null!=(n=p.watchContentSize)&&n);return}if(u===s.uZ.RunCode)try{let e=await O(p.code);return{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse",...e}}catch(e){return{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse",status:"error",logs:[],error:"Unexpected error executing code: "+(e instanceof Error?e.message:String(e))}}if(u===s.uZ.GetScreenshot){if(o===y.vU.Html){let e=new Promise(e=>{F.current=e});null==(l=L.current)||null==(r=l.contentWindow)||r.postMessage({type:"takeScreenshot"},"*");let t=await e;return{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse",screenshot:t.success?t.screenshot:null}}let e=document.getElementById("artifacts-component-root-svg")||document.getElementById("artifacts-component-root-react")||document.getElementById("mermaid");return e?{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse",screenshot:await (0,w.$E)(e,{imagePlaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII="})}:{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse",screenshot:null}}if(u===s.uZ.CopyHtmlContent)return{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse",reportHTMLContent:B()};if(u===s.uZ.ProxyFetchStream){let{channelId:e,chunk:t,done:n,error:r}=p;c(e,t,n,r);return}else if(u===s.uZ.GetDOMSnapshot)return{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetDOMSnapshotResponse",domSnapshot:await Q(o||"")}},[D,o]),{sendRequest:Z}=h({parentWindow:window.parent,allowedOrigins:I,onOutsideRequest:H});(0,m.useEffect)(()=>{if(!Z||!n||!o)return;let e=()=>{Z(s.uZ.DOMContentLoaded,{"@type":"type.googleapis.com/google.protobuf.Empty"})},t=()=>{setTimeout(e,2e3)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()},[Z,n,o]);let z="parent"===(0,x.useSearchParams)().get("errorReportingMode")?"parent":"sandbox",G=(0,m.useCallback)(e=>{"parent"===z&&e?null==Z||Z(s.uZ.ReportError,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest",error:e}):R(e)},[z,Z]);U({sendRequest:Z,handleError:G}),(0,m.useEffect)(()=>{X()||t()},[t]),(0,m.useEffect)(()=>{if(!Z)return;let e=!0,t=0,n=20;return async function(){for(;e&&t<n;)try{let t=await Promise.race([null==Z?void 0:Z(s.uZ.ReadyForContent,{"@type":"type.googleapis.com/google.protobuf.Empty"}),new Promise((e,t)=>setTimeout(()=>t(Error("Timeout")),200))]);return e=!1,t}catch(e){++t>=n&&console.warn("Max retries reached while trying to send ready message"),await new Promise(e=>setTimeout(e,500))}}(),()=>{e=!1}},[Z]),(0,m.useEffect)(()=>(D(),M.current=setTimeout(()=>{S(!0)},3e3),()=>{M.current&&clearTimeout(M.current)}),[n,o,D]);let W=(0,m.useCallback)(t=>{var n;if(!e.some(e=>t.origin==="".concat(e.scheme,"://").concat(e.origin))||!t.data.type||!t.data.content)return;D();let{type:r,content:s,watchContentSize:o,tailwindStylesEnabled:l}=t.data;i(r),a(s),f(null!=l&&l),d(null!=o&&o),null==(n=t.source)||n.postMessage({type:"MESSAGE_RECEIVED",requestId:t.data.requestId},{targetOrigin:t.origin})},[e,D]);return((0,m.useEffect)(()=>(window.addEventListener("message",W),window.parent&&e.forEach(e=>{window.parent.postMessage({type:"USER_CONTENT_RENDERER_READY"},"".concat(e.scheme,"://").concat(e.origin))}),()=>window.removeEventListener("message",W)),[W,e]),(0,m.useEffect)(()=>{if(!Z)return;let e=e=>{if(!(e.target instanceof HTMLElement))return;let t=e.target.closest("a");if(t&&t.href)if(e.preventDefault(),e.stopImmediatePropagation(),t.href.startsWith("blob-request:")){let e=p(t.href);if(!e)return;e.arrayBuffer().then(n=>{null==Z||Z(s.uZ.DownloadFile,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile",filename:t.download,data:n,mimeType:e.type||"application/octet-stream"})})}else if(t.href.startsWith("data:")){let[e,n]=t.href.split(","),r=e.match(/data:([^;]+)/),a=r?r[1]:"application/octet-stream",o=atob(n),i=Uint8Array.from(o,e=>e.charCodeAt(0)).buffer;null==Z||Z(s.uZ.DownloadFile,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile",filename:t.download,data:i,mimeType:a})}else{let e;try{e=new URL(t.href)}catch(e){return}if(e.hostname===window.location.hostname)return;null==Z||Z(s.uZ.OpenExternal,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal",href:t.href})}};return document.addEventListener("click",e,!1),()=>window.removeEventListener("click",e)},[Z]),(0,m.useEffect)(()=>{if(!Z)return;let e=e=>{let t=e.target;t instanceof HTMLElement&&"IFRAME"!==t.tagName&&(null==Z||Z(s.uZ.TrackInteraction,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.TrackInteraction",interactionType:"click"}))};return document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}},[Z]),g&&"sandbox"===z)?(0,r.jsx)($,{error:g}):(0,r.jsx)(b.ErrorBoundary,{errorComponent:e=>{let{error:t}=e;return G({type:"RuntimeError",message:t.message}),null},children:(0,r.jsx)(E,{enabled:l,sendRequest:Z,children:n&&o?(0,r.jsxs)(r.Fragment,{children:[o===y.vU.Html&&(0,r.jsx)(N.r,{content:n,ref:L,onScreenshot:_}),o===y.vU.Svg&&(0,r.jsx)(P.c,{content:n}),o===y.vU.Mermaid&&(0,r.jsx)(T.Z,{content:n}),o===y.vU.React&&(0,r.jsx)(q.N,{content:n,handleError:G,tailwindStylesEnabled:u}),o===y.qK.Pdf&&(0,r.jsx)(A,{content:n}),o===y.pW.Repl&&(0,r.jsx)(k.b,{initialCode:n,sendRequest:Z})]}):C?(0,r.jsx)("div",{className:"flex min-h-full w-full items-center justify-center bg-gray-100 p-4",children:(0,r.jsx)(j,{title:"Loading is taking longer than expected",description:"There may be an issue with the content you’re trying to load. ",subtext:"The code itself may still be valid and functional. "})}):(0,r.jsx)("div",{className:"loader"})})},n)}},31670:(e,t,n)=>{"use strict";n.d(t,{g:()=>p});var r=n(54568),s=n(7620),a=n(60799),o=n(2970),i=n(79531),l=n(92730),c=n(80584),d=n(22710);let u=()=>{let{zoomIn:e,zoomOut:t}=(0,a._5)(),[n,u]=(0,s.useState)(!1),p=(0,s.useCallback)(()=>{let e=document,t=e.documentElement;e.fullscreenElement?e.exitFullscreen&&(e.exitFullscreen(),u(!1)):(t.requestFullscreen(),u(!0))},[]);return(0,r.jsx)("div",{className:"absolute bottom-2 right-2 z-10 flex flex-col",children:(0,r.jsxs)("div",{className:"flex flex-col gap-0.5 rounded-md border-[0.5px] border-[#636d83a0] p-0.5",children:[(0,r.jsx)(d.Button,{className:"flex !h-7 !w-7 items-center justify-center !border-0 !bg-transparent !px-0 !text-[#636D83] !shadow-none hover:!bg-[#3338421f]",variant:"outline",onClick:t=>{t.preventDefault(),e()},children:(0,r.jsx)(o.A,{size:16})}),(0,r.jsx)("div",{className:"h-[0.5px] w-full px-1",children:(0,r.jsx)("hr",{className:"border-b-[0.5px] border-t-0 border-[#636D83a0]"})}),(0,r.jsx)(d.Button,{className:"flex !h-7 !w-7 items-center justify-center !border-0 !bg-transparent !px-0 !text-[#636D83] !shadow-none hover:!bg-[#3338421f]",variant:"outline",onClick:e=>{e.preventDefault(),t()},children:(0,r.jsx)(i.A,{size:16})}),(0,r.jsx)("div",{className:"h-[0.5px] w-full px-1",children:(0,r.jsx)("hr",{className:"border-b-[0.5px] border-t-0 border-[#636D83a0]"})}),(0,r.jsx)(d.Button,{className:"flex !h-7 !w-7 items-center justify-center !border-0 !bg-transparent !px-0 !text-[#636D83] !shadow-none hover:!bg-[#3338421f]",variant:"outline",onClick:e=>{e.preventDefault(),p()},children:n?(0,r.jsx)(l.A,{size:16}):(0,r.jsx)(c.A,{size:16})})]})})},p=e=>{let{children:t,style:n}=e,[o,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>{i(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),(0,r.jsx)("div",{className:"".concat(o?"fixed inset-0 z-50":"h-screen w-full"," [&>.react-transform-wrapper>.react-transform-component]:flex [&>.react-transform-wrapper>.react-transform-component]:h-full [&>.react-transform-wrapper>.react-transform-component]:w-full [&>.react-transform-wrapper>.react-transform-component]:cursor-move [&>.react-transform-wrapper>.react-transform-component]:items-center [&>.react-transform-wrapper>.react-transform-component]:justify-center [&>.react-transform-wrapper>.react-transform-component]:p-4 [&>.react-transform-wrapper]:h-full [&>.react-transform-wrapper]:w-full"),style:n,children:(0,r.jsxs)(a.GT,{doubleClick:{disabled:!1},children:[(0,r.jsx)(u,{}),(0,r.jsx)(a.WZ,{children:t})]})})}},53120:(e,t,n)=>{"use strict";n.d(t,{m:()=>i,x:()=>o});var r=n(21155),s=n(44124);let a=new Map;class o{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=s._s.safeParse(e.data);if(!n.success)return void console.warn("Received message does not conform to basic message shape, ignoring");let r=n.data;if("response"===r.channel)return void this.handleResponse(r);this.messageQueue.push(r),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||a.get(e.requestId);if(void 0!==t){t(e),a.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=r.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,a=r.x8.safeParse(e);if(!a.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let o=a.data;if(this.requestLog.has(o.requestId)){this.sendErrorResponse(o.requestId,400,"Request ID already processed");continue}this.requestLog.set(o.requestId,{message:o,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(o.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(o.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(o,this.boundSendRequest).then(e=>{var t;let n=s.Ko.parse({channel:"response",status:200,requestId:o.requestId,payload:null!=e?e:s.qs}),r=this.requestLog.get(o.requestId);r&&this.requestLog.set(o.requestId,{...r,response:n,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(o.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var r;let a=s.t6.parse({channel:"response",status:t,requestId:e,payload:(0,s.SV)(n)}),o=this.requestLog.get(e);o&&this.requestLog.set(e,{...o,response:a,responseTimestamp:new Date().getTime()}),null==(r=this.iframe.contentWindow)||r.postMessage(a,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,n){return new Promise((o,i)=>{var l,c;let d=Date.now().toString(),u={channel:"request",method:e,requestId:d,payload:t},p=e=>{let t=s.Ko.safeParse(e);if(!t.success)return void i(Error("Invalid response format"));let n=t.data;if(n.status>=400){let e=s.t6.safeParse(n);e.success?i(Error(e.data.payload.error)):i(Error("Error response (".concat(n.status,")")));return}let a=r.v9.safeParse(n);a.success?o(a.data.payload):i(Error("Invalid response payload for the method"))};this.inFlightRequests.set(d,p),a.set(d,p),n&&n.length>0?null==(l=this.iframe.contentWindow)||l.postMessage(u,this.allowedOrigin,n):null==(c=this.iframe.contentWindow)||c.postMessage(u,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:r,onCapabilityAction:s}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=r,this.onCapabilityAction=s,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}class i{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(!1===this.allowedOrigins.includes(e.origin)||e.source!==this.parentWindow)return;let t=s._s.safeParse(e.data);if(!t.success)return void console.warn("Received message does not conform to basic request shape, ignoring");let n=t.data;if("response"===n.channel)return void this.handleResponse(n);if(!r.Rv.safeParse(n.method).success)return void this.sendErrorResponse(n.requestId,400,"Unknown method");let a=r.OR.safeParse(n);if(!a.success)return void this.sendErrorResponse(n.requestId,400,"Invalid payload content");let o=a.data;this.onOutsideRequest(o).then(e=>{let t=s.Ko.parse({channel:"response",status:200,requestId:o.requestId,payload:null!=e?e:s.qs});this.sendMessage(t)}).catch(e=>{console.error("Error processing action for method ".concat(o.method,":"),e),this.sendErrorResponse(o.requestId,500,"Internal error while processing action")})}sendErrorResponse(e,t,n){let r=s.t6.parse({channel:"response",status:t,requestId:e,payload:(0,s.SV)(n)});this.sendMessage(r)}sendMessage(e){this.allowedOrigins.forEach(t=>{this.parentWindow.postMessage(e,t)})}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.inFlightRequests.clear()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t)return void t(e)}async sendRequest(e,t){return new Promise((n,a)=>{let o=Date.now().toString()+Math.random().toString(),i={channel:"request",method:e,requestId:o,payload:t},l=e=>{let t=s.Ko.safeParse(e);if(!t.success)return void a(Error("Invalid response format"));let o=t.data;if(o.status>=400){let e=s.t6.safeParse(o);e.success?a(Error(e.data.payload.error)):a(Error("Error response (".concat(o.status,")")));return}let i=r.sS.safeParse(o);i.success?n(i.data.payload):a(Error("Invalid response payload for the method"))};this.inFlightRequests.set(o,l),this.sendMessage(i)})}constructor({parentWindow:e,allowedOrigins:t,onOutsideRequest:n}){this.inFlightRequests=new Map,this.parentWindow=e,this.allowedOrigins=t,this.onOutsideRequest=n,this.boundHandleMessage=this.handleMessage.bind(this),this.setupMessageListener()}}},79285:(e,t,n)=>{"use strict";n.d(t,{ClientConfigurationProvider:()=>o,t:()=>i});var r=n(54568),s=n(7620);let a=(0,s.createContext)(null);function o(e){let{children:t,value:n}=e;return(0,r.jsx)(a.Provider,{value:n,children:t})}function i(){let e=(0,s.useContext)(a);if(!e)throw Error("useClientConfiguration must be used within a ClientConfigurationProvider");return e}},92971:(e,t,n)=>{Promise.resolve().then(n.bind(n,25249))}},e=>{var t=t=>e(e.s=t);e.O(0,[3907,4800,9386,38,4129,3327,5006,2421,8363,1675,5730,3336,149,1155,2198,7674,587,1902,7358],()=>t(92971)),_N_E=e.O()}]);