"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2947],{20878:(e,n,t)=>{t.d(n,{W:()=>r});var l=t(68096),a=t(1761),i=t(7620);function r(){let{mutate:e,isPending:n}=(0,l.Jy)(),{account:t}=(0,a.YL)();return{dismiss:(0,i.useCallback)(n=>{var l,a,i;t&&(null!=t&&null!=(a=t.settings)&&null!=(l=a.dismissed_claudeai_banners)&&l.some(e=>e.banner_id===n)||e({...t.settings,dismissed_claudeai_banners:[...(null==t||null==(i=t.settings)?void 0:i.dismissed_claudeai_banners)||[],{banner_id:n,dismissed_at:new Date().toISOString()}]}))},[t,e]),isDismissed:(0,i.useCallback)(e=>{var n,l;return(null==t||null==(l=t.settings)||null==(n=l.dismissed_claudeai_banners)?void 0:n.some(n=>n.banner_id===e))||!1},[t]),isPending:n}}},45078:(e,n,t)=>{t.d(n,{rX:()=>f,v2:()=>p,vP:()=>b});var l=t(68096),a=t(7726),i=t(98518),r=t(1761),o=t(27062),u=t(77101),s=t(85544),d=t(57383),c=t(75973),v=t(85717),_=t(71436),g=t(45715);let p=()=>{let{initGithubAuth:e}=(0,_.nB)(),{initDriveAuth:n}=(0,v.cI)();return t=>{t===u.v8.GITHUB?e():t===u.v8.GDRIVE?n():t===u.v8.OUTLINE&&(0,g.so)()}},m=()=>{let{value:e}=(0,o.fS)("claudeai_paprika_sticky"),n=["enabled_web_search","enabled_bananagrams","enabled_sourdough","enabled_foccacia","enabled_mcp_tools","enabled_monkeys_in_a_barrel"];return e&&n.push("paprika_mode"),n},b=e=>{let{conversation:n,pendingConversationSettings:t}=(0,d.o)(),{account:l}=(0,r.YL)(),a=m();if(n){var i;return null==(i=n.conversationSettings)?void 0:i[e]}return a.includes(e)?null==l?void 0:l.settings[e]:null==t?void 0:t[e]},f=()=>{let{conversation:e,setPendingConversationSettings:n}=(0,d.o)(),{account:t}=(0,r.YL)(),o=m(),{isInBeam:u,beamConversationSettings:v,setBeamConversationSettings:_}=(0,c.d)(),{track:g}=(0,i.st)(),{mutate:p}=(0,l.Jy)(),{mutate:b}=(0,a.HF)(null==e?void 0:e.id),f=l=>{if(!t)return;e?b({settings:{...l}}):u&&_&&_({...v,...l});let a={},i=!1;Object.keys(l).forEach(t=>{let r=l[t];o.includes(t)?(Object.assign(a,{[t]:r}),i=!0):s.W$.includes(t)&&!e&&n({[t]:r}),g({event_key:"claudeai.conversation.setting.toggled",conversation_uuid:(null==e?void 0:e.id)||null,setting:t,value:r})}),i&&p({...t.settings,...a})};return{toggleConversationSetting:(e,n)=>{f({[e]:n})},batchToggleConversationSettings:f}}},45564:(e,n,t)=>{t.d(n,{Q:()=>u,t:()=>s});var l=t(54568),a=t(89256),i=t.n(a),r=t(7620);let o=(0,r.createContext)({isOpen:!1,dropdownToOpen:void 0,openModal:i(),closeModal:i(),clearCallerIdentifier:i()}),u=e=>{let{children:n}=e,[t,a]=(0,r.useState)(!1),i=(0,r.useRef)(void 0),[u,s]=(0,r.useState)(void 0);return(0,l.jsx)(o.Provider,{value:{isOpen:t,openModal:e=>{a(!0),i.current=e},closeModal:()=>{a(!1),s(i.current)},dropdownToOpen:u,clearCallerIdentifier:()=>{s(void 0)}},children:n})},s=()=>(0,r.useContext)(o)},45715:(e,n,t)=>{t.d(n,{AI:()=>s,I5:()=>d,n0:()=>u,qp:()=>c,so:()=>v});var l=t(77186),a=t(1761),i=t(71473);t(77101);var r=t(87606);t(7620);var o=t(91768);let u=e=>{let{uri:n}=e,{data:t,isLoading:r}=(e=>{let{documentId:n}=e,{account:t,activeOrganization:r}=(0,a.YL)(),o=null==t?void 0:t.uuid,u=null==r?void 0:r.uuid,d=s();return(0,l.Sk)("/api/organizations/".concat(u,"/sync/mcp/outline/document/").concat(n),{queryKey:[i.hq,{accountUUID:o,orgUUID:u,documentId:n}],enabled:d})})({documentId:n});return{title:null==t?void 0:t.title,isLoading:r}},s=()=>{let{data:e}=(0,o.LN)();return!1},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,a.YL)(),r=null==t?void 0:t.uuid,o=s(),{data:u,refetch:d}=(0,l.Sk)("/api/organizations/".concat(r,"/sync/mcp/outline/auth"),{queryKey:[i.iP,{accountUUID:null==n?void 0:n.uuid,orgUUID:r}],enabled:!!(t&&o),staleTime:5e3}),{mutate:c,isPending:v}=(0,l.L2)("/api/organizations/".concat(r,"/sync/mcp/outline/auth/start"),"POST",{enabled:!!(t&&o),...e,onSuccess:function(){for(var n,t=arguments.length,l=Array(t),a=0;a<t;a++)l[a]=arguments[a];null==(n=e.onSuccess)||n.call(e,...l)}});return{isOutlineAuthenticated:!!(null==u?void 0:u.is_authenticated),refetch:d,initOutlineAuth:c,isLoadingOutlineAuthInit:v}},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,a.YL)(),o=null==n?void 0:n.uuid,u=null==t?void 0:t.uuid,d=s(),c=(0,r.useQueryClient)();return(0,l.L2)("/api/organizations/".concat(u,"/sync/mcp/outline/auth"),"DELETE",{enabled:!!(t&&d),...e,onSuccess:function(){for(var n,t=arguments.length,l=Array(t),a=0;a<t;a++)l[a]=arguments[a];c.invalidateQueries({queryKey:[i.iP,{accountUUID:o,orgUUID:u}]}),null==(n=e.onSuccess)||n.call(e,...l)}})},v=()=>{let e=encodeURIComponent(window.location.href);window.location.href="/settings/connectors?redirect_url=".concat(e,"&open_outline_auth=true")}},85717:(e,n,t)=>{t.d(n,{$f:()=>O,K6:()=>M,L5:()=>P,LP:()=>w,U5:()=>C,cI:()=>A,ef:()=>q,fb:()=>z,kJ:()=>E,qL:()=>T,vT:()=>R,y:()=>k,yy:()=>L,zF:()=>D,zH:()=>Y});var l=t(68096),a=t(77186),i=t(1761),r=t(51121),o=t(71473),u=t(27062),s=t(77101),d=t(90119),c=t(21036),v=t(87606),_=t(62942),g=t(7620),p=t(46760),m=t(98251),b=t(45564),f=t(93049),y=t(91768),h=t(40459);let S="gdrive_success",L=()=>{let e=(0,i.mV)(),{data:n}=(0,y.LN)(),t=!!(Array.isArray(n)&&n.find(e=>e.type===s.v8.GDRIVE&&e.enabled));return!e||t},I=()=>{let{value:e}=(0,u.fS)("kingfisher_enabled"),n=(0,c.useLayer)("trials_freemium").get("free_integrations",!1);return e||n},w=()=>{let e=L(),n=I();return!!(!h.env.NEXT_PUBLIC_DISABLE_GDRIVE_INTEGRATION&&n&&e)},E=()=>{let{account:e,activeOrganization:n}=(0,i.YL)(),t=null==n?void 0:n.uuid,l=w(),{data:r,isFetched:u}=(0,a.Sk)("/api/organizations/".concat(t,"/sync/mcp/drive/auth"),{queryKey:[o.jR,{accountUUID:null==e?void 0:e.uuid,orgUUID:t}],enabled:l,staleTime:3e5});return{isAuthenticated:l&&!!(null==r?void 0:r.is_authenticated),isFetched:u}},A=function(){let{callerIdentifier:e,handleAuthSuccess:n,pathname:t,queryString:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{isAuthenticated:u,isFetched:s}=E(),{addSuccess:c}=(0,r.Y)(),m=(0,p.A)(),{dropdownToOpen:f,clearCallerIdentifier:h}=(0,b.t)(),L=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null==n||n(e),c(m.formatMessage({defaultMessage:"Successfully connected to Google Drive",id:"7RI6njc31e"}))},I=(e=>{let{callerIdentifier:n,pathname:t,queryString:l}=e,r=(0,_.usePathname)(),{account:u,activeOrganization:s}=(0,i.YL)(),c=null==u?void 0:u.uuid,p=null==s?void 0:s.uuid,m=w(),b=(0,v.useQueryClient)(),f=(0,d.V)(),h=(0,_.useSearchParams)(),{mutate:L}=(0,a.L2)("/api/organizations/".concat(p,"/sync/mcp/drive/auth/start"),"POST",{enabled:m,onSuccess:e=>{window.location.href=e.redirect_url}}),I=(0,g.useRef)(!1);return()=>{if(!m)return;let e="".concat(S,"=").concat(n).concat(l?"&".concat(l):""),a=(0,y.dH)({pathname:t||r,searchParams:h,queryString:e,isClaudeApp:f});if(b.invalidateQueries({queryKey:[o.jR,{accountUUID:c,orgUUID:p}]}),f)return void window.open("/settings/connectors?open_in_browser=1&auth_start=gdrive&origin=".concat(a));I.current||(I.current=!0,L({pre_auth_state:{origin:a},redirect_uri:new URL("/connect/mcp/drive/callback",window.location.origin).toString()}))}})({callerIdentifier:e,pathname:t,queryString:l});return(0,y.FZ)({callerIdentifier:e,successParam:S,handleOpen:L}),(0,g.useEffect)(()=>{e&&f===e&&(null==n||n(!0),h())},[f,n,e,h]),{isDriveAuthenticated:u,initDriveAuth:I,handleDriveTrigger:L,isFetched:s}},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,i.YL)(),l=null==n?void 0:n.uuid,r=null==t?void 0:t.uuid,u=w(),s=(0,v.useQueryClient)(),{mutate:d}=(0,m.ih)();return(0,a.L2)("/api/organizations/".concat(r,"/sync/mcp/drive/auth"),"DELETE",{enabled:!!(t&&u),...e,onSuccess:function(){for(var n,t=arguments.length,a=Array(t),i=0;i<t;i++)a[i]=arguments[i];s.invalidateQueries({queryKey:[o.jR,{accountUUID:l,orgUUID:r}]}),d({}),null==(n=e.onSuccess)||n.call(e,...a)}})},k=e=>{let{documentId:n}=e,{account:t,activeOrganization:l}=(0,i.YL)(),r=null==t?void 0:t.uuid,u=null==l?void 0:l.uuid,s=w(),d=(0,v.useQueryClient)(),c=(0,a.Sk)("/api/organizations/".concat(u,"/sync/mcp/drive/document/").concat(n,"?include_content=false"),{queryKey:[o.QB,{accountUUID:r,orgUUID:u,documentId:n}],enabled:s,meta:{noToast:!0}}),_=c.isError;return(0,g.useEffect)(()=>{_&&d.invalidateQueries({queryKey:[o.jR,{accountUUID:r,orgUUID:u}]})},[d,_,r,u]),c};function D(e){let{uri:n}=e,{data:t,isLoading:l}=k({documentId:n});return{title:null==t?void 0:t.title,isLoading:l}}let T=e=>{let{account:n,activeOrganization:t}=(0,i.YL)(),l=null==n?void 0:n.uuid,r=null==t?void 0:t.uuid,u=w(),s=(0,g.useMemo)(()=>e.map(e=>"/api/organizations/".concat(r,"/sync/mcp/drive/document/").concat(e)),[e,r]),d=(0,g.useMemo)(()=>({queryKey:e.map(e=>[o.qM,{accountUUID:l,orgUUID:r,documentId:e}]),enabled:u,meta:{noToast:!0}}),[e,l,r,u]);return(0,a._i)(s,d)},Y=e=>{let{account:n,activeOrganization:t}=(0,i.YL)(),l=null==n?void 0:n.uuid,r=null==t?void 0:t.uuid,u=w(),s=(0,f.bI)(),{data:d,isSuccess:c,isLoading:v}=(0,a.Sk)("/api/organizations/".concat(r,"/sync/mcp/drive/recents"),{queryKey:[o.zu,{accountUUID:l,orgUUID:r}],enabled:e&&u,meta:{noToast:!0}});return(0,g.useEffect)(()=>{if(c&&d){let e=d.map(e=>{let{uri:n,title:t}=e;return{uri:n,title:t}});(0,f.Ac)(e)}},[c,d]),{recentDriveDocs:c?d:s,isLoading:v}},z=()=>{let e=I(),{value:n}=(0,u.fS)("apps_use_bananagrams"),t=(0,c.useLayer)("trials_freemium").get("free_integrations",!1);return e&&n||t},M=()=>{let e=w(),n=z();return e&&n&&!h.env.NEXT_PUBLIC_DISABLE_GDRIVE_INTEGRATION},O=e=>{var n;let t=M(),{account:l}=(0,i.YL)();return!!t&&(e?!!(null==e||null==(n=e.conversationSettings)?void 0:n.enabled_bananagrams):!!(null==l?void 0:l.settings.enabled_bananagrams))},P=()=>(0,u.fS)("rag_prototype").value,R=()=>{let e=M(),n=(0,i.mV)(),{data:t}=(0,y.LN)(),{account:l}=(0,i.YL)(),a=P();return!!e&&!!a&&(n?!!(Array.isArray(t)&&t.find(e=>{var n;return e.type===s.v8.GDRIVE&&e.enabled&&(null==(n=e.config)?void 0:n.allow_indexing)})):!!(null==l?void 0:l.settings.enabled_gdrive_indexing))},q=()=>{let{account:e}=(0,i.YL)(),{mutate:n}=(0,l.Jy)(),{mutate:t}=(0,m.Bg)();return{toggleDriveSearchAndIndexingEnabled:l=>{var a;let{indexingEnabled:i,searchEnabled:r,dismissBanner:o}=l,u=o||!!i;i&&t({}),n({...null==e?void 0:e.settings,...void 0!==i?{enabled_gdrive_indexing:i}:null,...void 0!==r||!0===i?{enabled_bananagrams:null!=i?i:r}:null,...u?{dismissed_claudeai_banners:[...(null==e||null==(a=e.settings)?void 0:a.dismissed_claudeai_banners)||[],{banner_id:"drive_indexing_enablement_2/11_1",dismissed_at:new Date().toISOString()}]}:null})}}}},92947:(e,n,t)=>{t.d(n,{$V:()=>C,Ic:()=>S,Hj:()=>q,Cc:()=>P,Ib:()=>M,vx:()=>E,kX:()=>A,QD:()=>T,HJ:()=>w,gt:()=>L,sb:()=>I,BN:()=>D,M8:()=>z,ko:()=>k,AY:()=>Y,es:()=>O}),t(98878);var l=t(68096),a=t(7726),i=t(98518),r=t(1761),o=t(65631),u=t(27062),s=t(90119),d=t(97136),c=t.n(d),v=t(62942),_=t(7620),g=t(75006),p=t(20878),m=t(57383),b=t(21036),f=t(75973),y=t(45078),h=t(91768);let S=(0,_.createContext)({mcpClients:{},servers:[],mcpTools:[],isLoading:!1,isEnabled:!1}),L=()=>{let e=(0,_.useContext)(S);return e||console.warn("useMcp being used outside of McpProvider, this is probably a bug"),e},I=()=>{let{value:e}=(0,u.fS)("bagel_enabled");return e},w=()=>{let{value:e}=(0,u.fS)("inline_tool_approval");return e},E=()=>{let{account:e,activeOrganization:n}=(0,r.YL)(),t=(0,r.mV)(),l=(0,o.pG)(e,n,"claude-ai"),a=(0,o.yI)(e,n,o.Nt.IntegrationsManage);return!t||l||a},A=()=>{let e=(0,r.zm)(),n=E();return e&&!n},C="mcp_directory_chin",k=function(){var e,n;let{shouldTrack:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,_.useRef)(!1),a=I(),{dismiss:i}=(0,p.W)(),{account:o}=(0,r.YL)(),u=A(),s=new Date,d="".concat(s.getDate(),"-").concat(s.getMonth(),"-").concat(s.getFullYear()),c="".concat(C,"_").concat(d),v=(null!=(n=null==o||null==(e=o.settings.dismissed_claudeai_banners)?void 0:e.map(e=>e.banner_id))?n:[]).filter(e=>e.includes(C)),g=(0,_.useMemo)(()=>!(!a||u||v.includes(C))&&(!(v.length>3)||!v.includes(c)),[u,a,v,c]);return(0,_.useEffect)(()=>{!l.current&&g&&!v.includes(c)&&t&&(i(c),l.current=!0)},[c,v,t,i,g]),g},D=()=>{let e=(()=>{let{value:e}=(0,u.fS)("claude_ai_allow_tool_always_allow");return e})(),{getMcpToolApprovalRequestSetting:n}=function(){let{value:e}=(0,b.useDynamicConfig)("mcp_tool_approval_config"),n=(0,_.useCallback)((n,t,l)=>{var a,i,r,o;return e?(null==(a=e[n])?void 0:a[t])!==void 0?e[n][t]:(null==(i=e[n])?void 0:i["*"])!==void 0?e[n]["*"]:(null==(r=e["*"])?void 0:r[t])!==void 0?e["*"][t]:(null==(o=e["*"])?void 0:o["*"])!==void 0?e["*"]["*"]:l:l},[e]);return{toolApprovalConfig:e,getMcpToolApprovalRequestSetting:n}}();return{getApprovalSetting:(0,_.useCallback)((t,l)=>{var a;let i=n(null!=t?t:"",null!=(a=null==l?void 0:l.name)?a:"",e?"perChat":"always");return{approvalSetting:i,alwaysAllowEnabled:"perChat"===i}},[e,n])}},T=function(){let{pathname:e,queryString:n=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),l=(0,v.usePathname)(),a=(0,v.useSearchParams)(),o=(0,s.V)(),{track:d}=(0,i.st)();(0,u.fS)("claudeai_beam").value;let c="".concat("").concat((0,h.dH)({pathname:e||l,searchParams:a,queryString:n,isClaudeApp:o}));return e=>{let{uuid:n,url:l}=e;d({event_key:"claudeai.mcp.auth.init",uuid:n,url:l}),window.location.href="/api/organizations/".concat(null==t?void 0:t.uuid,"/mcp/start-auth/").concat(n,"?redirect_url=").concat(c,"&open_in_browser=1")}},Y=()=>{let{servers:e}=L();return!!(0,s.V)()&&(e.filter(e=>{let{type:n}=e;return"local"===n})||[]).length>0},z=()=>{var e,n,t;let l=(0,m.o)(),a=(null==(e=l.pendingConversationSettings)?void 0:e.compass_mode)==="advanced"||(null==(t=l.conversation)||null==(n=t.conversationSettings)?void 0:n.compass_mode)==="advanced",{servers:i}=L(),r=(i.filter(e=>{let{type:n}=e;return"remote"===n})||[]).length>0;return a&&r},M=()=>{var e;let n=null!=(e=(0,y.vP)("enabled_mcp_tools"))?e:{};return(0,_.useMemo)(()=>Object.entries(n).filter(e=>{let[n,t]=e;return!!t}).map(e=>{let[n]=e;return n}),[n])},O=()=>{let{conversation:e}=(0,m.o)(),{account:n}=(0,r.YL)(),{isInBeam:t,beamConversationSettings:o,setBeamConversationSettings:u}=(0,f.d)(),{track:s}=(0,i.st)(),{mutate:d}=(0,l.Jy)(),{mutate:c}=(0,a.HF)(null==e?void 0:e.id);return{toggleMcpToolEnabled:(l,a,i)=>{if(!n)return;let r=Array.isArray(l)?l.reduce((e,n)=>({...e,[n]:a}),{}):{[l]:a};if(e){var v;c({settings:{enabled_mcp_tools:{...null==(v=e.conversationSettings)?void 0:v.enabled_mcp_tools,...r}}})}else t&&u&&u({...o,enabled_mcp_tools:{...(null==o?void 0:o.enabled_mcp_tools)||{},...r}});let _=n.settings.enabled_mcp_tools;d({...n.settings,enabled_mcp_tools:{..._,...r}}),s({event_key:"claudeai.mcp.tool.toggled",conversation_uuid:(null==e?void 0:e.id)||null,setting:l,value:a,url:i})},toggleMcpToolAlwaysApproved:(e,t)=>{if(!n)return;let l=n.settings.enabled_mcp_tools;d({...n.settings,enabled_mcp_tools:{...l,[e]:t}})}}};function P(e,n){return"".concat(e,":").concat(n)}let R=g.z.object({description:g.z.string().optional(),type:g.z.string().optional(),title:g.z.string().optional()}).optional();function q(e){let n=e.enabledKey,t=e.description||"",l=function(e){var n;let t=Object.entries((null==(n=e.inputSchema)?void 0:n.properties)||{}),l=[];for(let[e,n]of t){let{data:t}=R.safeParse(n),a=(null==t?void 0:t.description)||"";l.push([e,a])}return l.sort((e,n)=>e[0].localeCompare(n[0])).flat().join(",")}(e),a=c().createHash("md5").update("".concat(t,":").concat(l)).digest("hex");return"".concat(n,"-").concat(a)}}}]);